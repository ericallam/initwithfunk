
<!DOCTYPE HTML>
<html>
<head>
	<meta name="google-site-verification" content="f1OtvP7JCHm6M9Ca7vMcFg3q-1NEOvDMcSKfKlVW_pA" />
	<script data-cfasync="false" type="text/javascript" src="//use.typekit.net/axj3cfp.js"></script>
	<script data-cfasync="false" type="text/javascript">try{Typekit.load();}catch(e){}</script>
	<meta charset="utf-8">
	<title>initWithFunk: by Eric Allam</title>

<meta name="author" content="Eric Allam"> 

<meta name="description" content="If you have any feedback on this article, please contact me on twitter I&rsquo;ve spent an unwise amount of time recently on a problem that arose &hellip;"> <meta name="keywords" content="">

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="initWithFunk:" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script type="text/javascript" src="//cdn.sublimevideo.net/js/7rwly8ga.js"></script>

	<style>
		#header h1 {
			font-size: 60px;
		}

		#header h4 {
			margin-top: 22px;
		}
	</style>
</head>


<body>
	<header id="header" class="inner"><h1><a href="/">initWithFunk:</a></h1>
<h4>Disclaimer: opinions expressed below do not belong to <a href="http://twitter.com/eallam">Eric Allam</a></h4>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul>
	<li><a href="/">Blog</a></li>
	<li><a href="/about">About</a></li>
	<li><a href="/portfolio">Portfolio</a></li>
	<li><a href="/archives">Archive</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:initwithfunk.com">
			</form>
		</div>
	</div>
</nav>


</header>

	<div id="content" class="inner">


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/05/31/breaking-bad-with-dtrace/">
		
			Breaking Bad With DTrace</a>
	</h2>
	<div class="entry-content">
		<p><em>If you have any feedback on this article, please contact me on <a href="http://twitter.com/eallam">twitter</a></em></p>

<p>I&rsquo;ve spent an unwise amount of time recently on a problem that arose when me and my <a href="http://www.codeschool.com">Code School</a> colleagues were developing the challenges for our upcoming <a href="http://www.codeschool.com/paths/ios">course on MapKit</a>. All of the challenges assume that the user has given the app permission to use it&rsquo;s current location, and our <a href="https://github.com/square/KIF%E2%80%8E">KIF</a> tests in the simulator wouldn&rsquo;t work unless we could somehow programmatically confirm this alert box:</p>

<p><img src="http://i.imgur.com/te7Spyj.jpg" style="width: 294px;" /></p>

<p><a href="https://github.com/square/KIF%E2%80%8E">KIF</a> tests run in the simulator and are built to a different target, so using private API&rsquo;s isn&rsquo;t a problem (KIF wouldn&rsquo;t work unless it used a ton of private API&rsquo;s). <a href="https://twitter.com/puls">Jim Puls</a> from Square (the makers of KIF) was helpful enough to chime in <a href="https://groups.google.com/d/msg/kif-framework/_MffdyvMizU/hvbM6LJO7woJ">this thread</a> to share how they do it at Square: by <a href="http://darkdust.net/writings/objective-c/method-swizzling">method swizzling</a> the crap out of the <code>CLLocationManager</code> class, replacing <code>startUpdatingLocation</code>, <code>location</code>, and <code>locationServicesEnabled</code> with their own versions so the user location mechanics would be wholesale replaced, thus getting around the permission alert box.</p>

<p>We followed their advice and ended up mocking out <code>CLLocationManager</code> (see how in <a href="https://gist.github.com/rubymaverick/5689235">this gist</a>) and it worked well enough, but I was unsatisfied that we had to mock out the entire location machinery just to get rid of that permissions alert box. It wasn&rsquo;t elegant code.</p>

<blockquote><p>&#8230;perfection is finally attained not when there is no longer anything to add, but when there is no longer anything to take away&#8230;</p><footer><strong>Antoine de Saint-Exupéry</strong> <cite><a href='http://english.stackexchange.com/questions/38837/where-does-this-translation-of-saint-exuperys-quote-on-design-come-from'>english.stackexchange.com/38837/&hellip;</a></cite></footer></blockquote>


<p>I decided to keep searching for a more elegant solution and I started at what I thought was the most obvious place: <code>UIAlertView</code>.</p>

<h3>Searching for UIAlertView</h3>

<p>If I could find the code where the offending <code>UIAlertView</code> is actually created then I would know which code to mock out and hopefully bypass permissions. To do this, I could have swizzled some <code>UIAlertView</code> init methods or added a <a href="http://developer.apple.com/library/ios/#recipes/xcode_help-breakpoint_navigator/articles/adding_a_symbolic_breakpoint.html">symbolic breakpoint</a> in Xcode, but I had recently come across <a href="https://twitter.com/borkware">Mark Dalymple&rsquo;s</a> excellent three part series on DTrace (<a href="http://blog.bignerdranch.com/1907-hooked-on-dtrace-part-1/">1</a>, <a href="http://blog.bignerdranch.com/1968-hooked-on-dtrace-part-2/">2</a>, and <a href="http://blog.bignerdranch.com/2031-hooked-on-dtrace-part-3/">3</a>), and this seemed like a good opportunity to use it for a worthy real-world problem.</p>

<p>I created a new blank iOS 6.0 project with a single <code>MKMapView</code> that wants to show the current user location (you can <a href="http://courseware.codeschool.com.s3.amazonaws.com/try_ios/TestingCurrentLocation.zip">⬇download the project here</a>). I built and ran the app for the simulator to verify that it brought up the alert box and to create a binary that I would later use in Instruments as a target for a custom DTrace instrument.</p>

<p><img src="http://f.cl.ly/items/0f0U0g3L0u2y1f470g1e/iOS%20Simulator%20Screen%20shot%20Jun%201,%202013%2010.52.56%20AM.png" alt="location alert" /></p>

<p>Instruments is powered by DTrace and by using it it made a couple of things easier, like launching an app in the simulator as it attached DTrace probes and logged the results, as well as a cleaner interface for viewing call stack information. To create custom DTrace probes in Instruments, start by opening Instruments from Xcode:</p>

<p><img src="http://i.imgur.com/69FkXod.jpg" alt="open instruments" /></p>

<p>And then create a new blank document:</p>

<p><img src="http://i.imgur.com/RJeaV4F.jpg" alt="blank document" /></p>

<p>Use <code>⌘B</code> to build a new instrument, and you should come across this screen:</p>

<p><img src="http://i.imgur.com/9U3uHBU.jpg" alt="new instrument" /></p>

<p>Which presents a nice interface for creating custom DTrace scripts.  To find all methods (class or instance) called on <code>UIAlertView</code>, I ended up with this:</p>

<p><img src="http://i.imgur.com/EAj9EjF.jpg" alt="uialertview" /></p>

<p>The part to pay attention to is this group of boxes here:</p>

<p><img src="http://f.cl.ly/items/0R2S250R0b1m1y1P430i/Image%202013.06.01%2011%3A10%3A53%20AM.png" alt="group" /></p>

<p>Next up I needed to the choose the target this instrument would run against</p>

<p><img src="http://i.imgur.com/keNunJe.jpg" alt="target" /></p>

<p>You have to pick the executable that was built for the simulator, which you can find in <code>~/Library/Application\ Support/iPhone\ Simulator/6.0/Applications/</code>. In there you might see many directories with randomly generated names:</p>

<p><img src="http://i.imgur.com/NxLWCRN.jpg" alt="rando" /></p>

<p>You&rsquo;ll have to dig through the noise to find the executable you want:</p>

<p><img src="http://i.imgur.com/CeUjegf.jpg" alt="noise" /></p>

<p>Now all that&rsquo;s left is to hit the record button and hope we can find out where that <code>UIAlertView</code> is being initialized:</p>

<p><video id="eWX4nh-HFXM" class="sublime" width="640" height="360" data-uid="eWX4nh-HFXM" data-youtube-id="eWX4nh-HFXM" data-autoresize="fit" preload="none" poster="http://f.cl.ly/items/0Q3L1g1X1t2G1I0n2k1v/UIAlertViewCast1Poster.png">
</video></p>

<p>As you can see, there were 3 UIAlertView method calls that all came from <code>[UIWindow keyWindow]</code>, and one from a <code>performSelector</code>, but that doesn&rsquo;t help us much.  Let&rsquo;s update that probe to record both the module (in this case the class name), and the name of the method</p>

<p><img src="http://i.imgur.com/VvkCSnX.jpg" alt="adding information" /></p>

<p>Now it&rsquo;s a little easier to see what&rsquo;s going on.  It looks like <code>[UIWindow keyWindow]</code> calls private class method <code>+_alertWindow</code> on <code>UIAlertView</code>.</p>

<p><img src="http://i.imgur.com/JLhoerL.jpg" alt="private" /></p>

<p>Could this be where our location permissions alert box is being created. Fortunately, our instrument&rsquo;s probe automatically records the stack trace information for each of the events recorded.  To view the stack trace information, we just need to select an event and open the right hand side drawer:</p>

<p><img src="http://f.cl.ly/items/3v3h0A3R3Q2Z24330N1n/Image%202013.06.02%2010%3A25%3A53%20AM.png" alt="stack trace" /></p>

<p>The stack trace of the <code>_alertWindow</code> calls are all the same, and lead to a dead end. They don&rsquo;t seem to be related to location at all but instead are triggered on normal app startup routines.  The only other hit we got, <code>+_initializeSafeCategory</code>, is related to Accessibility and not location.</p>

<p>This is a dead end.</p>

<p>Well, not exactly.  Using DTrace I was able to eliminate the possibility that the <code>UIAlertView</code> was created inside the TestingCurrentLocation process, which means it has to be created in another process.  So I knew that somehow, my TestingCurrentLocation process was communicating with another outside process which was responsible for location permissions. Apple doesn&rsquo;t want to give app developers the chance of getting around the location permissions box for privacy reasons, so they would want to lock it down in another process.</p>

<h3>The Mystery Process</h3>

<p>So my next goal was to figure out what this mystery outside process was. I knew that my app process and the mystery process had to communicate, which led me to research the <a href="http://developer.apple.com/library/mac/#documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/CreatingXPCServices.html">XPC Services API</a> which &ldquo;provides a lightweight mechanism for basic interprocess communication integrated with Grand Central Dispatch (GCD) and launchd&rdquo; and is an integral part of <a href="http://developer.apple.com/library/mac/#documentation/Security/Conceptual/AppSandboxDesignGuide/AboutAppSandbox/AboutAppSandbox.html#//apple_ref/doc/uid/TP40011183">App Sandboxing</a>, so it seemed like an interested place to start.  I tried logging all methods called on parts of the Objective-C API, like <code>NSXPCConnection</code>, and <code>NSXPCInterface</code>, but there was nothing there. The next most obvious thing to probe was the c API, specifically the <a href="http://developer.apple.com/library/mac/#documentation/System/Reference/XPC_connection_header_reference/Reference/reference.html#//apple_ref/c/func/xpc_connection_create">xpc_connection_create</a> function. Here is how I created the probe I to log all the calls to <code>xpc_connection_create</code> with the caller and the <code>name</code> of the service with which to connect:</p>

<p><video id="4z7meAsOgAQ" class="sublime" width="640" height="360" data-uid="4z7meAsOgAQ" data-youtube-id="4z7meAsOgAQ" data-autoresize="fit" preload="none" poster="http://f.cl.ly/items/113t1y2T07161b3e3a3U/xpc_connection_cast_poster.png">
</video></p>

<p>As you can see, probing this function turned out to bear some real fruit. It found a call to <code>xpc_connection_create</code> that was creating a connection to something named <code>com.apple.locationd.registration</code> and the call stack confirmed that this being triggered by setting the map to display the users location:</p>

<p><img src="http://f.cl.ly/items/3F2e1x1L2p2c2X1c3a3R/Image%202013.06.02%2011%3A33%3A03%20AM.png" alt="xpc_connection_create results" /></p>

<p>Running <code>sudo ps aux | grep locationd</code> showed that their was indeed a <code>locationd</code> process running in the simulator located at <code>/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator6.0.sdk/usr/libexec/locationd</code> (there was also one running at <code>/usr/libexec/locationd</code> which is the location daemon for Mac OS X.)</p>

<h3>locationd</h3>

<p>This gave me a new process to probe for information. But what should I look for?  I knew that if a user allowed an app in the simulator to get their location, they wouldn&rsquo;t be asked again even if the simulator was restarted (only by resetting the simulator would the location permissions alert box come up again).  So I knew that there had to be somewhere on the filesystem where locationd was storing the permission authorizations for simulator apps. If I could find this file (most likely a preferences file), I could possibly inject authorization for an app before it ever ran, thus never displaying the alert box even on the apps first run in the simulator.</p>

<p>So how do I find what files the locationd process is opening and reading and writing to? Well, that&rsquo;s where the <code>syscall</code> DTrace provider comes in, which allows you to probe all system calls (like <code>open</code>, <code>read</code>, <code>write</code>, <code>chdir</code>, etc.).  This provider makes it really easy to find out which files a process is opening and writing to by probing the <code>open</code> and <code>write</code> functions.  For example, here is a DTrace script for printing out all the files opened by the <code>locationd</code> process:</p>

<figure class='code'><figcaption><span>locationopens.d </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='d'><span class='line'><span class="n">syscall</span><span class="p">::</span><span class="n">open</span><span class="p">*:</span><span class="n">entry</span>
</span><span class='line'><span class="p">/</span><span class="n">execname</span> <span class="p">==</span> <span class="s">&quot;locationd&quot;</span><span class="p">/</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>   <span class="n">printf</span><span class="p">(</span><span class="s">&quot;locationd open %s\n&quot;</span><span class="p">,</span> <span class="n">copyinstr</span><span class="p">(</span><span class="n">arg0</span><span class="p">));</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This script will trace all system calls to <code>open*</code> (<code>*</code> is a wildcard), but only on processes with the name &ldquo;locationd&rdquo; (the <code>/execname == "locationd"/</code> line defines a predicate for the probe). The code between the curly-braces is the action to perform on each match. Inside the curly-braces we are printing the first argument to <code>open</code>, which is the path of the file (to find out which arguments a system call takes, use <code>man 2 syscall</code> which in this case would be <code>man 2 open</code>).  We have to use <code>copyinstr</code> to copy data from the process into the kernel&rsquo;s address space (where DTrace runs).</p>

<p>Running this with <code>dtrace -s locationopens.d</code> (make sure you have root priviledges: run <code>sudo -i</code> to start a new shell in root) and then running our TestingCurrentLocation app in the simulator results in a couple hundred lines that look like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>
</span><span class='line'>  0    927              open_nocancel:entry locationd open /System/Library/CoreServices/SystemVersion.bundle
</span><span class='line'>
</span><span class='line'>  0    141                       open:entry locationd open /Users/eric/Library/Application Support/iPhone Simulator/6.0/Library/Preferences/.GlobalPreferences.plist
</span><span class='line'>
</span><span class='line'>  0    927              open_nocancel:entry locationd open /System/Library/CoreServices/SystemVersion.bundle/English.lproj
</span><span class='line'>
</span><span class='line'>  0    927              open_nocancel:entry locationd open /System/Library/CoreServices/SystemVersion.bundle/Base.lproj
</span><span class='line'>
</span><span class='line'>  0    141                       open:entry locationd open /System/Library/CoreServices/SystemVersion.bundle/English.lproj/SystemVersion.strings
</span><span class='line'>
</span><span class='line'>  0    141                       open:entry locationd open /System/Library/CoreServices/SystemVersion.bundle/English.lproj/SystemVersion.stringsdict
</span></code></pre></td></tr></table></div></figure>


<p>We can get rid of some of the noise by running dtrace with the <code>-q</code> option, like so:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ dtrace -q -s locationopens.d
</span><span class='line'>...snip a bunch of lines...
</span><span class='line'>locationd open /Users/eric/Library/Application Support/iPhone Simulator/6.0/Library/Preferences/com.apple.locationd.plist
</span><span class='line'>locationd open /System/Library/CoreServices/ServerVersion.plist
</span><span class='line'>locationd open /System/Library/CoreServices/SystemVersion.plist
</span><span class='line'>locationd open /System/Library/CoreServices/SystemVersion.bundle
</span><span class='line'>locationd open /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator6.0.sdk/usr/libexec
</span><span class='line'>locationd open /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator6.0.sdk/usr/libexec/locationd
</span><span class='line'>...snip a bunch of lines...</span></code></pre></td></tr></table></div></figure>


<p>Okay that&rsquo;s a lot of file opens, and it would take awhile going through every single one looking for clues.  What I really want to know is: what files does locationd <em>write</em> to when a user taps the &ldquo;OK&rdquo; button in the location alert box, and what data does it write? For that we are going to need another DTrace script:</p>

<figure class='code'><figcaption><span>locationwrites.d </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='d'><span class='line'><span class="n">syscall</span><span class="p">::</span><span class="n">write</span><span class="p">*:</span><span class="n">entry</span>
</span><span class='line'><span class="p">/</span><span class="n">execname</span> <span class="p">==</span> <span class="s">&quot;locationd&quot;</span><span class="p">/</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>   <span class="n">printf</span><span class="p">(</span><span class="s">&quot;locationd write %s\n\n%s\n\n&quot;</span><span class="p">,</span> <span class="n">fds</span><span class="p">[</span><span class="n">arg0</span><span class="p">].</span><span class="n">fi_pathname</span><span class="p">,</span> <span class="n">copyinstr</span><span class="p">(</span><span class="n">arg1</span><span class="p">));</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here we are tracing all calls to <code>write*</code> and printing out the path name using the first argument (arg0) which is a file descriptor (for more on using file descriptors in DTrace, read <a href="http://milek.blogspot.com/2005/07/file-descriptors-in-dtrace.html">this tutorial</a>). We are also printing out the second argument (arg1) which is a buffer of the contents written to the file. Now if we run the script just before we confirm we want to allow this app to use our current location, we will know where locationd is writing to save this information.</p>

<p><video id="X29i348ea4I" class="sublime" width="640" height="360" data-uid="X29i348ea4I" data-youtube-id="X29i348ea4I" data-autoresize="fit" preload="none" poster="http://f.cl.ly/items/2X303t1A1s2C1Z243I0J/locationdwrites_poster.png">
</video></p>

<p>This results in just one trace match writing to a file at <code>??/locationd/clients.plist</code>. If we run the <code>locationopens.d</code> script again while grepping for <code>clients.plist</code> we can find the full path to this file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ dtrace -q -s locationopens.d | grep 'clients.plist'
</span><span class='line'>locationd open /Users/eric/Library/Application Support/iPhone Simulator/6.0/Library/Caches/locationd/clients.plist</span></code></pre></td></tr></table></div></figure>


<h3>The solution</h3>

<p>When I opened this file for the first time I had to find someone in the office to high-five.  Here it was, the file that tells locationd, and thus apps in the simulator, whether or not the user has permitted use of location information.  I could convert the <code>clients.plist</code> file into xml using <code>plutil -convert xml1 clients.plist</code> and then open it up and see what was inside:</p>

<figure class='code'><figcaption><span>clients.plist </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
</span><span class='line'><span class="cp">&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;</span>
</span><span class='line'><span class="nt">&lt;plist</span> <span class="na">version=</span><span class="s">&quot;1.0&quot;</span><span class="nt">&gt;</span>
</span><span class='line'><span class="nt">&lt;dict&gt;</span>
</span><span class='line'>  <span class="nt">&lt;key&gt;</span>com.codeschool.TestingCurrentLocation<span class="nt">&lt;/key&gt;</span>
</span><span class='line'>  <span class="nt">&lt;dict&gt;</span>
</span><span class='line'>    <span class="nt">&lt;key&gt;</span>Authorized<span class="nt">&lt;/key&gt;</span>
</span><span class='line'>    <span class="nt">&lt;true/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;key&gt;</span>BundleId<span class="nt">&lt;/key&gt;</span>
</span><span class='line'>    <span class="nt">&lt;string&gt;</span>com.codeschool.TestingCurrentLocation<span class="nt">&lt;/string&gt;</span>
</span><span class='line'>    <span class="nt">&lt;key&gt;</span>Executable<span class="nt">&lt;/key&gt;</span>
</span><span class='line'>    <span class="nt">&lt;string&gt;</span>/Users/eric/Library/Application Support/iPhone Simulator/6.0/Applications/D2700670-4F2D-4A4B-A881-695E9812CB86/TestingCurrentLocation.app/TestingCurrentLocation<span class="nt">&lt;/string&gt;</span>
</span><span class='line'>    <span class="nt">&lt;key&gt;</span>LocationTimeStopped<span class="nt">&lt;/key&gt;</span>
</span><span class='line'>    <span class="nt">&lt;real&gt;</span>391883613.42615497<span class="nt">&lt;/real&gt;</span>
</span><span class='line'>    <span class="nt">&lt;key&gt;</span>Registered<span class="nt">&lt;/key&gt;</span>
</span><span class='line'>    <span class="nt">&lt;string&gt;</span>/Users/eric/Library/Application Support/iPhone Simulator/6.0/Applications/D2700670-4F2D-4A4B-A881-695E9812CB86/TestingCurrentLocation.app/TestingCurrentLocation<span class="nt">&lt;/string&gt;</span>
</span><span class='line'>    <span class="nt">&lt;key&gt;</span>Whitelisted<span class="nt">&lt;/key&gt;</span>
</span><span class='line'>    <span class="nt">&lt;false/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/dict&gt;</span>
</span><span class='line'><span class="nt">&lt;/dict&gt;</span>
</span><span class='line'><span class="nt">&lt;/plist&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Property List&rsquo;s (.plist) are a strange format but not impossible to read. The real important bit seemed to be the <code>Authorized</code> key which was set to <code>&lt;true/&gt;</code>.  I tried changing that to <code>&lt;false/&gt;</code> and rerunning the app in the simulator and my app no longer had access to location information and also didn&rsquo;t bring up the location permission alert box. If I removed the entire <code>&lt;dict&gt;&lt;/dict&gt;</code> block representing my app, the location permission alert box would show back up the next time I ran the app in the simulator.</p>

<p>I now had full control over that location alert box. All I had to do was write over the <code>clients.plist</code> file with the xml already crafted in a way to give my app access to location information. For our upcoming MapKit course, we&rsquo;re doing it inside our executor server (which is written in ruby), kind of like this:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">write_out_location_plist_hack!</span>
</span><span class='line'>  <span class="n">plist</span> <span class="o">=</span> <span class="sx">%{</span>
</span><span class='line'><span class="sx">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
</span><span class='line'><span class="sx">&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;</span>
</span><span class='line'><span class="sx">&lt;plist version=&quot;1.0&quot;&gt;</span>
</span><span class='line'><span class="sx">&lt;dict&gt;</span>
</span><span class='line'><span class="sx">  &lt;key&gt;com.codeschool.</span><span class="si">#{</span><span class="vi">@project</span><span class="o">.</span><span class="n">project_name</span><span class="si">}</span><span class="sx">&lt;/key&gt;</span>
</span><span class='line'><span class="sx">  &lt;dict&gt;</span>
</span><span class='line'><span class="sx">    &lt;key&gt;Authorized&lt;/key&gt;</span>
</span><span class='line'><span class="sx">    &lt;true/&gt;</span>
</span><span class='line'><span class="sx">    &lt;key&gt;BundleId&lt;/key&gt;</span>
</span><span class='line'><span class="sx">    &lt;string&gt;com.codeschool.</span><span class="si">#{</span><span class="vi">@project</span><span class="o">.</span><span class="n">project_name</span><span class="si">}</span><span class="sx">&lt;/string&gt;</span>
</span><span class='line'><span class="sx">  &lt;/dict&gt;</span>
</span><span class='line'><span class="sx">&lt;/dict&gt;</span>
</span><span class='line'><span class="sx">&lt;/plist&gt;</span>
</span><span class='line'><span class="sx">}</span><span class="o">.</span><span class="n">strip</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">clients_plist</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span class='line'>    <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s2">&quot;~&quot;</span><span class="p">),</span>
</span><span class='line'>    <span class="s2">&quot;Library&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;Application Support&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;iPhone Simulator&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;6.0&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;Library&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;Caches&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;locationd&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;clients.plist&quot;</span>
</span><span class='line'>  <span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">clients_plist</span><span class="p">,</span> <span class="s2">&quot;w+&quot;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span>
</span><span class='line'>    <span class="n">file</span><span class="o">.</span><span class="n">puts</span> <span class="n">plist</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>The code above runs before the app is launched in the simulator, and it works perfectly. We were able to get rid of the nasty <a href="https://gist.github.com/rubymaverick/5689235">CLLocationManager mocking</a> and I was finally able to move on to something more productive.</p>

<p>But trying to solve this problem did lead me to learn a lot more about DTrace. Before, DTrace just seemed like this magical thing used by superhero programmers. Now that I&rsquo;ve used it so solve a real problem, it&rsquo;s not so magical anymore, and I am already starting to think of other problems I could solve using it that I wouldn&rsquo;t have been able to before. I hope that by writing about how I used DTrace to solve this problem, it will lead you to try it out the next time you are stuck on something similar.  If you do, please let me know how you did by getting in touch with me on my <a href="http://twitter.com/eallam">twitter</a>.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-05-31T21:25:00-04:00" pubdate data-updated="true">May 31<span>st</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/dtrace/'>DTrace</a>, <a class='category' href='/blog/categories/instruments/'>Instruments</a>, <a class='category' href='/blog/categories/xcode/'>Xcode</a>, <a class='category' href='/blog/categories/debugging/'>debugging</a>, <a class='category' href='/blog/categories/ios/'>iOS</a>, <a class='category' href='/blog/categories/locationd/'>locationd</a>, <a class='category' href='/blog/categories/simulator/'>simulator</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/05/26/the-case-of-the-wwdc-sellout/">
		
			The Case of the WWDC Sellout</a>
	</h2>
	<div class="entry-content">
		<p><img src="http://i.imgur.com/A0WoI4T.jpg" /></p>

<p>It starts in the throat. Like a burly man with a size 13 boot stepping down on your neck, the feeling that something horrible has gone wrong.</p>

<p>There is a bug in production.</p>

<p>Any programmer that has a modicum of experience shipping software knows this feeling, because programmers are the leading cause of bugs on Earth<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>.  It&rsquo;s a terrible feeling and almost always leads to the worst day in a programmer&rsquo;s life up until that point<sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup>.</p>

<p>But very few of us have experienced a day quite like the day one or more programmers had when WWDC &ldquo;Sold Out&rdquo; a couple weeks ago. The sale should have been a complete success: unprecedented demand, a rabid group of developers with their credit cards in hand.  After only <a href="http://www.marco.org/2013/05/24/71-seconds">71 seconds</a> went by, the WWDC ticket site featured a prominent &ldquo;Sold Out&rdquo; banner and the dreams of thousands of developers were instantly crushed, yours truly included.</p>

<p>But then, just a few hours later, something strange happened: developers started getting mysterious phone calls from Apple letting them know they had tickets for them. I was one of the those developers. I was there as the clock rendered<sup id="fnref:3"><a href="#fn:3" rel="footnote">3</a></sup> 10am PST and I was able to put a WWDC ticket in my Shopping Cart<sup id="fnref:4"><a href="#fn:4" rel="footnote">4</a></sup>, but when I submitted the payment form I was greated with a 500 error and when I went back to the cart it was empty, and the tickets were sold out.  The Apple Developer support person who called me only said that they knew that I had tried to purchase a ticket for WWDC and they still had it available for me to purchase, and that I&rsquo;d be getting an email in the next 12 hours allowing me to grab it.</p>

<p>There have been theories as to what happened, and Marco Arment <a href="http://www.marco.org/2013/05/24/71-seconds">just posted</a> his theory this weekend:</p>

<blockquote><p>My best guess: some part of the infrastructure handling the purchases mistook 4,500 connections, transactions, or sessions for 4,500 sales. And when the front-end servers collapsed under the load of everyone hitting them at once — a first this year, since the availability time was preannounced — we all started refreshing, those connections started stacking up, and something on the back-end triggered the “Sold Out” state early because it was mistakenly counting all of those failed sessions</p></blockquote>


<p>I think he&rsquo;s close but a little bit off. My guess is that there were multiple problems with their ticket reservation system. Reservation systems are very easy to screw up<sup id="fnref:5"><a href="#fn:5" rel="footnote">5</a></sup>, especially in distributed systems.</p>

<p>Here is how I think it went down:</p>

<p>All the tickets were reserved (by placing a ticket into the cart you&rsquo;d effectively &ldquo;reserve&rdquo; the ticket), and a majority of those reservations were fulfilled by the developer checking out and paying for the ticket.  The rest of the reservations were wrongly fulfilled when there was a bug in the checkout process that caused an exception somewhere in the distributed stack.  The checkout process failed in a way that isolated itself from the reservation system, so the final state was a fulfilled reservation, an empty cart, and an unpurchased ticket. What likely remained as evidence to the correct state of the system were log files scattered over dozens of servers and in a variety of formats.  That&rsquo;s why it took so long to begin calling (according to anecdotal twitter reports and my own call, I&rsquo;m guessing it took 5+ hours), and why Apple couldn&rsquo;t make an immediate announcement as to what happened: they didn&rsquo;t know themselves.</p>

<p>I don&rsquo;t envy the programmers who probably spent a couple sleepless nights figuring the mess out, and I am grateful that they&rsquo;ve been reaching out to developers to try and get them the tickets they deserve for WWDC.  As a first-time attendant, I&rsquo;m looking forward to meeting an Apple engineer or two, and maybe buying them a beer or a cranberry juice, giving them a pat on the back, and letting them know that we&rsquo;ve been there, we knew how they were feeling, that something terrible happened but it&rsquo;s not the end of the world.</p>

<p>There was a bug in production.<sup id="fnref:6"><a href="#fn:6" rel="footnote">6</a></sup></p>
<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
<p>Unproven hypothesis: I&rsquo;ve created more bugs than 99% of the population<a href="#fnref:1" rev="footnote">&#8617;</a></p></li>
<li id="fn:2">
<p>Programmers are very dramatic<a href="#fnref:2" rev="footnote">&#8617;</a></p></li>
<li id="fn:3">
<p>Clocks don&rsquo;t &ldquo;strike&rdquo; anymore, do they?<a href="#fnref:3" rev="footnote">&#8617;</a></p></li>
<li id="fn:4">
<p>We&rsquo;re going to need to rethink that metaphor soon. The Amazon Generation won&rsquo;t know what the hell we&rsquo;re talking about<a href="#fnref:4" rev="footnote">&#8617;</a></p></li>
<li id="fn:5">
<p>I know this because I&rsquo;ve written one and I screwed it up multiple times<a href="#fnref:5" rev="footnote">&#8617;</a></p></li>
<li id="fn:6">
<p>One can hope for WWDC 2013, amirite?<a href="#fnref:6" rev="footnote">&#8617;</a></p></li>
</ol>
</div>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-05-26T17:32:00-04:00" pubdate data-updated="true">May 26<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/random-development/'>Random Development</a>, <a class='category' href='/blog/categories/wwdc/'>WWDC</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/05/09/try-objective-c-and-learning-to-code/">
		
			Announcing Try Objective-C</a>
	</h2>
	<div class="entry-content">
		<p><img src="https://d1ffx7ull4987f.cloudfront.net/images/achievements/large_badge/246/completed-try-objective-c-d2ebeb17d5acfd77df0bf3ae3d2b89f7.png" alt="Badge" /></p>

<p>Today we are releasing the free <a href="tryobjectivec.codeschool.com">Try Objective-C</a> course to our <a href="http://www.kickstarter.com/projects/eallam/try-ios-iphone-app-development-course">Kickstarter backers</a> and anyone else who wants to learn Objective-C, the language that powers iOS and Mac OS X apps.</p>

<p>When I first launched this Kickstarter project, I wasn&rsquo;t sure what kind of response we would get.  But after the first couple of days, it was clear that there were many, many people who wanted to learn how to build iOS apps. We were quickly met with a ton of requests for content for absolute beginners, people who had never coded before in their life but who desperately wanted to learn how to make iOS apps. I started work on an <a href="https://speakerdeck.com/rubymaverick/objective-c-primer-ft-mr-higgie">Objective-C Primer</a> to give beginners a chance at learning the language before starting on iOS.</p>

<p>But Objective-C is a pretty complex beast of a language. And so we made it a &ldquo;stretch&rdquo; goal of the project to produce a full blown, free, Objective-C course.</p>

<p>I didn&rsquo;t know what I&rsquo;d gotten us into.</p>

<p>Being experienced programmers, sometimes it&rsquo;s easy losing sight of how hard this stuff can be. We make too many assumptions and end up alienating a bunch of determined learners who feel like they aren&rsquo;t being told the whole story. The problem is, the story is HUGE. Especially for a language like Objective-C. It&rsquo;s an old language with a lot of power, but with that power comes a high level of complexity.  Luckily, recent advances of the language (like auto-synthesized properties, object literals, and most of all ARC) have brought that complexity down to a level where it has become much easier to learn.</p>

<p>The rise of the popularity and use of the App Store has resulted in an interested phenomena: tons of people are entering programming for the first time by trying to learn an incredibly hard language and framework.  We were reminded of this when we ran a private beta 4 weeks ago in our offices to help us with some feedback on the course and the content. We do private betas for all of our courses, and the beta for Try Objective-C had by far the most beginners of any beta we&rsquo;ve had.</p>

<p>And unfortunately at that point our content was failing the true beginner. So we started over. We rewrote the entire course. The course we are releasing today gives the true beginner a really good shot at actually learning this language. It&rsquo;s not perfect, and it&rsquo;s definitely not easy, but it&rsquo;s the most approachable course we could have written.  And even though someone with experience in programming will most definitely start down the path of learning Objective-C and iOS with this course, it was written with someone else in mind. It was written for my brother the T-shirt printer, for my fiancée the scientist, for my friend who is a single mom, for my neighbor with all the crazy app ideas, for my dentist, for my friends, and for all the people who messaged me on Kickstarter, wanting desperately to learn a new skill, to make something meaningful, to feel like they too could become a programmer.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-05-09T13:36:00-04:00" pubdate data-updated="true">May 9<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/kickstarter/'>Kickstarter</a>, <a class='category' href='/blog/categories/objective-c/'>Objective-C</a>, <a class='category' href='/blog/categories/code/'>code</a>, <a class='category' href='/blog/categories/ios/'>iOS</a>, <a class='category' href='/blog/categories/learning/'>learning</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2012/10/21/setting-up-kif-integration-tests-for-ios/">
		
			Setting Up KIF Integration Tests for iOS</a>
	</h2>
	<div class="entry-content">
		<p>Square released a pretty neat Integration Testing library called <a href="https://github.com/square/KIF">KIF</a> last year and we have been using it to test the challenges for our upcoming <a href="http://kickstarter.codeschool.com">Try iOS</a> course on <a href="http://www.codeschool.com/courses">Code School</a>.  The instructions in the KIF <a href="https://github.com/square/KIF/blob/master/README.md">README</a> on setting up an Xcode 4 project are missing a couple of crucial steps, and after much Googling and Stackoverflowing I finally figured out how to get it to work, so I figured I&rsquo;d share the process we are using for setting up KIF projects.</p>

<p>I&rsquo;m assuming you already have an Xcode 4 (version 4.5.1) project that you want to add KIF to. First, if you aren&rsquo;t already working with an Xcode workspace, you will need to create one for this project.  To do so, choose the &ldquo;Save as Workspace&rdquo; menu item:</p>

<p><img src="http://f.cl.ly/items/0j1A2b3Y132K2S2F0G1r/Resized%20Screen%202012-10-21%20at%2012.13.49%20PM.png" alt="image" /></p>

<p>You need a workspace so you can manage both your original project (in my example InstagramClone), and the KIF project we are about to add the the workspace. For more on workspaces check out <a href="http://developer.apple.com/library/ios/#featuredarticles/XcodeConcepts/Concept-Workspace.html">this Apple doc</a>.</p>

<p>Next, you&rsquo;ll want to download the KIF project from their <a href="https://github.com/square/KIF/downloads">downloads page</a>, and copy the files inside of a &ldquo;Frameworks&rdquo; directory under the Project Root.</p>

<p><img src="http://f.cl.ly/items/3Y1p0H471A381R2I0O43/Resized%20Screen%202012-10-21%20at%2012.19.56%20PM.png" alt="image" /></p>

<p>Next, go back to Xcode and command-click on empty area in the Project Navigator (⌘1), and choose &ldquo;Add Files to Project&rdquo;:</p>

<p><img src="http://f.cl.ly/items/1H37001a061B460V2o0b/Resized%20Screen%202012-10-21%20at%2012.21.08%20PM.png" alt="image" /></p>

<p>Navigate and select the &ldquo;KIF.xcodeproj&rdquo; file under Project Root->Frameworks->KIF.  Now the Project Navigator should look like you have two projects on equal footing:</p>

<p><img src="http://f.cl.ly/items/1t0222422N0u3H143f0q/Resized%20Screen%202012-10-21%20at%2012.27.00%20PM.png" alt="image" /></p>

<p>This is important, at this point it should not look like the &ldquo;KIF&rdquo; project is under the &ldquo;InstagramClone&rdquo; project.</p>

<p>Next, select your project in the Project Navigator and you should see information about Projects and Targetings in the main content area.  Command-click on your app target and choose &ldquo;Duplicate&rdquo;:</p>

<p><img src="http://f.cl.ly/items/392A1v290G1t152o1I41/Resized%20Screen%202012-10-21%20at%2012.31.19%20PM.png" alt="image" /></p>

<p>Then choose &ldquo;Duplicate Only&rdquo;:</p>

<p><img src="http://f.cl.ly/items/042Y0d1D2A2b1e2u1j3x/Resized%20Screen%202012-10-21%20at%2012.32.10%20PM.png" alt="image" /></p>

<p>You should see a new target named &ldquo;PROJECTNAME Copy&rdquo;. Select the target, press Enter, and change the name to something like &ldquo;Integration Tests&rdquo;:</p>

<p><img src="http://f.cl.ly/items/3C2g0m0l0k1p3C3h332k/Resized%20Screen%202012-10-21%20at%2012.33.52%20PM.png" alt="image" /></p>

<p>With the &ldquo;Integration Tests&rdquo; target selected, go to the &ldquo;Build Phases&rdquo; panel, expand the &ldquo;Link Binary With Libraries&rdquo; section, and click the little &ldquo;+&rdquo; button.  Select the &ldquo;libKif.a&rdquo; binary from the list and add it:</p>

<p><img src="http://f.cl.ly/items/3U462R3e0H2h2O091a3N/Resized%20Screen%202012-10-21%20at%2012.37.01%20PM.png" alt="image" /></p>

<p>Still with the &ldquo;Integration Tests&rdquo; target selected, go to the &ldquo;Build Settings&rdquo; panel.  Make sure you have &ldquo;All&rdquo; and &ldquo;Combined&rdquo; selected:</p>

<p><img src="http://f.cl.ly/items/0U02000V1U400O1W421u/Resized%20Screen%202012-10-21%20at%2012.41.54%20PM.png" alt="image" /></p>

<p>Search for the &ldquo;Header Search Paths&rdquo; and edit the setting to add <code>$(inherited)</code> and <code>$(SRCROOT)/Frameworks/KIF</code>, like so:</p>

<p><img src="http://f.cl.ly/items/3f1c1g0G3F2F0H0P2X1O/Resized%20Screen%202012-10-21%20at%2012.44.43%20PM.png" alt="image" /></p>

<p>Search for the &ldquo;Other Linker Flags&rdquo; setting and edit to add these flags:</p>

<p><img src="http://f.cl.ly/items/0j0g2H371P2I2M3S2y1k/Resized%20Screen%202012-10-21%20at%2012.47.12%20PM.png" alt="image" /></p>

<p>Next, add the <code>RUN_KIF_TESTS=1</code> Preprocessor Macro to both the &ldquo;Release&rdquo; and &ldquo;Debug&rdquo; targets, like so:</p>

<p><img src="http://f.cl.ly/items/3P2U1t1e3p1r272k1a0d/Resized%20Screen%202012-10-21%20at%2012.50.08%20PM.png" alt="image" /></p>

<p>Now that we&rsquo;ve configured the &ldquo;Integration Tests&rdquo; target correctly, we need to make sure that before Xcode builds the target, it also builds the KIF project.  To do this we need to do a couple of things (this is what you won&rsquo;t find in the instructions provided by Square).</p>

<p>First, we need to edit the &ldquo;PROJECTNAME Copy&rdquo; Xcode Scheme to tell it to build KIF.  To do that, go to &ldquo;Edit Schemes&rdquo; and select the &ldquo;PROJECTNAME Copy&rdquo; scheme.  Choose the &ldquo;Build&rdquo; phase.  You should see something like this:</p>

<p><img src="http://f.cl.ly/items/0F0q0G1H2L2d1P440u04/Resized%20Screen%202012-10-21%20at%2012.52.21%20PM.png" alt="image" /></p>

<p>Click on the little &ldquo;+&rdquo; button right above the &ldquo;Manage Schemes&rdquo; button, and Add the &ldquo;KIF&rdquo; target:</p>

<p><img src="http://f.cl.ly/items/3n2i2m260X2P442W050b/Resized%20Screen%202012-10-21%20at%2012.57.12%20PM.png" alt="image" /></p>

<p>Close the &ldquo;Edit Schemes&rdquo; dialog and go back to the Project Navigator.  Click and Drag the &ldquo;KIF&rdquo; project to under your App project.  In the dialog that appears, select both your app target and the &ldquo;Integration&rdquo; Tests target in the &ldquo;Add to targets&rdquo; section:</p>

<p><img src="http://f.cl.ly/items/1v2y1w3J2S3v151o1T0Y/Resized%20Screen%202012-10-21%20at%2012.59.29%20PM.png" alt="image" /></p>

<p>After clicking &ldquo;Finish&rdquo; your Project Navigator should look like this:</p>

<p><img src="http://f.cl.ly/items/0s3m3l0i0i2K0L2y3w1z/Resized%20Screen%202012-10-21%20at%2012.59.37%20PM.png" alt="image" />.</p>

<p>Now you should be able to follow the rest of Square&rsquo;s instructions for adding the Controller, Scenario, and Step files to test your app in the &ldquo;Example&rdquo; section of their <a href="https://github.com/square/KIF/blob/master/README.md">README</a></p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-10-21T12:03:00-04:00" pubdate data-updated="true">Oct 21<span>st</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/kif/'>KIF</a>, <a class='category' href='/blog/categories/testing/'>Testing</a>, <a class='category' href='/blog/categories/try-ios/'>Try iOS</a>, <a class='category' href='/blog/categories/xcode/'>Xcode</a>, <a class='category' href='/blog/categories/ios/'>iOS</a>


</div>
	
</div></article>

<nav id="pagenavi">
    
    
    <div class="center"><a href="/archives">Blog Archives</a></div>
</nav></div>
	<footer id="footer" class="inner">Copyright &copy; 2013

    Eric Allam

<br>
Powered by Octopress.
</footer>
	<script src="/javascripts/slash.js"></script>






<script type="text/javascript">
  var _gauges = _gauges || [];
  (function() {
    var t   = document.createElement('script');
    t.type  = 'text/javascript';
    t.async = true;
    t.id    = 'gauges-tracker';
    t.setAttribute('data-site-id', '51a38dc8613f5d7c63000012');
    t.src = '//secure.gaug.es/track.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(t, s);
  })();
</script>
</body>
</html>
